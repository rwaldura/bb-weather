<html>
  <head>
	<meta charset="UTF-8" />
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
// readonly MPH_KMH=1.609 # convert miles per hour to kilometers per hour
// readonly MPH_MS=2.2352 # convert miles per hour to meters per second
// CAST(ROUND(speed * $MPH_KMH) AS INTEGER) AS speed_kmh,
// CAST(ROUND(speed / $MPH_MS ) AS INTEGER) AS speed_ms
		
		function _getData(f_drawChart) 
		{
			var q = google.visualization.Query("getDataTable.cgi"); // same host
			q.send(
				function (response) { // google.visualization.QueryResponse
					if (response.isError()) 
					{
						console.log("query failed" + response.getMessage());
						google.visualization.errors.addErrorFromQueryResponse(
							document.getElementById("chart_errors"),
							response);
					} 
					else 
					{
						f_drawChart(response.getDataTable());
					}
				 }
			);			
		}
		
		function getData_fixed()
		{
			return new google.visualization.DataTable(
			{
				"cols": [ 
					{
						"id": "period",
						"label": "Aggregation Period",
						"type": "number"
					},
					{
						"id": "tstamp",
						"label": "Timestamp",
						"type": "date"
					},
					{
						"id": "direction",
						"label": "Wind Direction (degrees)",
						"type": "number"
					},		
					{
						"id": "heading",
						"label": "Heading",
						"type": "string"
					},		
					{
						"id": "speed_mph",
						"label": "Wind Speed (mph)",
						"type": "number"
					},
				],
				"rows": [ 
						{ "c": [
							{ "v": "1" },
							{ "v": new Date(2020,06,23,15,30) },
							{ "v": "106",     "f": "106 degrees" },
							{ "v": "E" },
							{ "v": "9", "f": "9 mph" },
						] },
						{ "c": [
							{ "v": "1" },
							{ "v": new Date(2020,06,23,15,31) },
							{ "v": "100",     "f": "100 degrees" },
							{ "v": "E" },
							{ "v": "3", "f": "3 mph" },
						] },
						{ "c": [
							{ "v": "3" },
							{ "v": new Date(2020,06,23,15,30) },
							{ "v": "103",     "f": "103 degrees" },
							{ "v": "E" },
							{ "v": "6", "f": "6 mph" },
						] },
						{ "c": [
							{ "v": "3" },
							{ "v": new Date(2020,06,23,15,33) },
							{ "v": "66",     "f": "66 degrees" },
							{ "v": "N" },
							{ "v": "66", "f": "66 mph" },
						] }, // DANGLINGI COMMA
				]
			});			
		}
		
		function drawChart(id, data) 
		{			
			var options = {
				chart: {
					title: 'Over the last 30 minutes, by minute',
					subtitle: 'Sales, Expenses, and Profit: 2014-2017',
				},
				bars: 'vertical' // Required for Material Bar Charts.
			};

			var chart = new google.charts.Bar(document.getElementById(id));
			chart.draw(data, google.charts.Bar.convertOptions(options));			
		}
		
		function debug(data)
		{
			var t = new google.visualization.Table(document.getElementById('data_debug'));
			t.draw(data, {showRowNumber: true});							
		}
		
	    google.charts.load('current', {'packages':['bar','table']});
	    google.charts.setOnLoadCallback(
			function () {
				var data = getData_fixed();

				for (var period of [1,3,10,60]) 
				{
					console.log("prerio = " + period)
					var v = new google.visualization.DataView(data);
					v.setRows(v.getFilteredRows([{column: 0, value: period}]));
					drawChart(period, 'chart_' + period + 'min', v);
				}
		    });
    </script>
  </head>
  <body>
	<div id="chart_errors"></div>
	<div id="data_debug"></div>
	<table>
		<tr>
			<td>
			    <div id="chart_1min" style="width: 512; height: 256;"></div>				
			</td>
			<td>
				<div id="chart_3min" style="width: 512; height: 256;"></div>				
			</td>
		</tr>
		<tr>
			<td>
			    <div id="chart_10min" style="width: 512; height: 256;"></div>				
			</td>
			<td>
				<div id="chart_60min" style="width: 512; height: 256;"></div>				
			</td>
		</tr>
	</table>
	<p>OK</p>
  </body>
</html>
